title: w3c/reportingapi/network_error

description: >
  Browser-generated problem reports, as described by the W3C Reporting API.
  https://www.w3.org/TR/reporting/
  This schema only accomodates the Network Error Logging API, and
  not the other report types available in the Reporting API.
  See https://w3c.github.io/network-error-logging/

$id: /w3c/reportingapi/network_error/1.0.0

$schema: https://json-schema.org/draft-07/schema#

type: object
additionalProperties: false
allOf:
  - $ref: /fragment/w3c/reportingapi/report/1.0.0#
  - properties:
      body:
        type: object
        description: The body of the report, with details on what failed and how.
        additionalProperties:
          type: string
        properties:
          referrer:
            type: string
            description: >
              The HTTP Referer header that was sent with the request that failed.
          sampling_fraction:
            type: number
            description: >
              The sampling_fraction originally requested by the origin server
              in its NEL response header.
          server_ip:
            type: string
            description: >
              Either the IP address of the server to which the user agent
              sent the failed request, or "".
          protocol:
            type: string
            description: >
              If available, this is the network protocol used to fetch the request
              that failed, as identified by the ALPN Protocol ID, or "".
          method:
            type: string
            description: >
              The HTTP method name used when attempting to fetch the failed
              request (e.g. "GET", "POST", etc)
          status_code:
            type: integer
            description: >
              Either the HTTP response code of the failed request,
              or 0 if not applicable.
          elapsed_time:
            type: number
            description: >
              In a network-error report, this is the number of milliseconds
              between the start of the failed request and when it was completed
              or aborted by the user agent.
          phase:
            type: string
            enum:
              - dns
              - connection
              - application
            description: >
              The phase at which the request failed.
          type:
            type: string
            description: >
              A string describing the kind of failure that occurred, like
              "dns.unreachable", "tcp.refused", "http.response.redirect_loop", etc.
              See https://w3c.github.io/network-error-logging/#predefined-network-error-types

examples:
  # These are directly from the draft Technical Report, except with $schema and meta added.
  # https://www.w3.org/TR/network-error-logging/#sample-network-error-reports
  - {"$schema": { "$ref": "#/$id" }, "meta": {"stream": "w3c.reportingapi.network_error", "dt": "2020-09-01T00:00:00Z"}, "age": 0, "type": "network-error", "url": "https://www.example.com/", "body": {"sampling_fraction": 0.5, "referrer": "http://example.com/", "server_ip": "123.122.121.120", "protocol": "h2", "method": "GET", "status_code": 200, "elapsed_time": 823, "type": "http.protocol.error"}}
  # NOTE: In these following examples, we $ref the  meta object out of the first example just to DRY it up.
  - {"$schema": { "$ref": "#/$id" }, "meta": {"$ref": "#/examples/0/meta"}, "age": 0, "type": "network-error", "url": "https://widget.com/thing.js", "body": {"sampling_fraction": 1.0, "referrer": "https://www.example.com/", "server_ip": "", "protocol": "", "method": "GET", "status_code": 0, "elapsed_time": 143, "type": "dns.name_not_resolved"}}
  - {"$schema": { "$ref": "#/$id" }, "meta": {"$ref": "#/examples/0/meta"}, "age": 0, "type": "network-error", "url": "https://new-subdomain.example.com/", "body": {"sampling_fraction": 1.0, "server_ip": "", "protocol": "http/1.1", "method": "GET", "status_code": 0, "elapsed_time": 48, "type": "dns.name_not_resolved"}}
  # An actual report as generated by Chrome 85.0.4183.83 (but with $schema and meta added).
  - {"$schema": { "$ref": "#/$id" }, "meta": {"$ref": "#/examples/0/meta"}, "age": 30654, "body": {"elapsed_time": 108, "method": "GET", "phase": "connection", "protocol": "http/1.1", "referrer": "", "sampling_fraction": 1, "server_ip": "", "status_code": 0, "type": "tcp.refused"}, "type": "network-error", "url": "https://mcnulty.nucleosynth.space:8443/", "user_agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36"}
